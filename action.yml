name: "Runner Cleanup Action"
description: "Aggressively reclaim disk space on GitHub-hosted runners."
inputs:
  remove-browsers:
    description: "If true, also remove browser caches and binaries."
    required: false
    default: "false"
  verbose:
    description: "If true, echo what is being removed."
    required: false
    default: "false"
runs:
  using: "composite"
  steps:
    - name: Disk space before cleanup
      shell: bash
      run: |
        echo "ðŸ“Š Disk space before cleanup:"
        df -h
    - name: Remove language/toolchain directories
      shell: bash
      run: |
        if [[ "${{ inputs.verbose }}" == "true" ]]; then
          echo "ðŸ§¼ Removing Java..."
          echo "ðŸ§¼ Removing .NET SDKs and Runtimes..."
          echo "ðŸ§¼ Removing Swift..."
          echo "ðŸ§¼ Removing Haskell (.ghcup)..."
          echo "ðŸ§¼ Removing Julia..."
          echo "ðŸ§¼ Removing Android SDK..."
          echo "ðŸ§¼ Removing Azure CLI..."
          echo "ðŸ§¼ Removing PowerShell..."
          echo "ðŸ§¼ Removing hostedtoolcache..."
        fi
        sudo rm -rf /usr/lib/jvm \
          /usr/share/dotnet \
          /usr/share/swift \
          /usr/local/.ghcup \
          /usr/local/julia* \
          /usr/local/lib/android \
          /opt/az \
          /usr/local/share/powershell \
          /opt/hostedtoolcache
    - name: Conditionally remove browsers
      if: inputs.remove-browsers == 'true'
      shell: bash
      run: |
        if [[ "${{ inputs.verbose }}" == "true" ]]; then
          echo "ðŸ§¼ Removing Chromium..."
          echo "ðŸ§¼ Removing Microsoft Edge/Chrome..."
          echo "ðŸ§¼ Removing Google Chrome..."
          echo "ðŸ§¼ Removing Firefox..."
        fi
        sudo rm -rf /usr/local/share/chromium \
          /opt/microsoft \
          /opt/google \
          /usr/lib/firefox
    - name: Prune Docker system
      shell: bash
      run: |
        if [[ "${{ inputs.verbose }}" == "true" ]]; then
          echo "ðŸ§¼ Cleaning Docker unused state..."
        fi
        docker system prune -af || true
        docker builder prune -af || true
    - name: Disk space after cleanup
      shell: bash
      run: |
        echo "ðŸ“Š Disk space after cleanup:"
        df -h
